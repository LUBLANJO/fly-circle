<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Play Flappy Bird game here for free. Choose your level: Easy, Medium, Hard, or Nightmare">
    <title>Flappy Bird</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #6ab0de, #b0e0f6, #ffb6c1);
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #game-container {
            width: 90vw;
            max-width: 800px;
            height: 67.5vw;
            max-height: 600px;
            position: relative;
            overflow: hidden;
            border: 10px solid #5a4b3c;
            border-radius: 20px;
            background-color: #87CEEB;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4), inset 0 0 15px rgba(0,0,0,0.2);
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        /* Bird */
        #bird {
            width: 40px;
            height: 40px;
            background-color: #0050FF;
            border-radius: 50%;
            position: absolute;
            left: 25%;
            top: 46.67%;
            transition: transform 0.1s ease-out;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            z-index: 5;
        }

        /* Pipes */
        .pipe {
            background: linear-gradient(to right, #28a745, #218838);
            border: 2px solid #19692c;
            position: absolute;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            z-index: 2;
        }

        .pipe-top { transform-origin: center top; }
        .pipe-bottom { transform-origin: center bottom; }

        /* Clouds */
        .cloud {
            width: 60px;
            height: 30px;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            border-radius: 15px;
            position: absolute;
            opacity: 0.6;
            z-index: 0;
        }

        /* Power-ups */
        .power-up {
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #ffd700, #ffa500);
            border-radius: 50%;
            position: absolute;
            z-index: 6;
            animation: pulse 1.5s infinite ease-in-out;
        }

        /* Trail */
        .trail {
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(0, 80, 255, 0.6), transparent 70%);
            border-radius: 50%;
            position: absolute;
            z-index: 4;
            animation: fadeOut 0.5s linear forwards;
        }

        /* UI Elements */
        #score, #scoreboard {
            position: absolute;
            top: 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(16px, 3vw, 24px);
            color: white;
            text-shadow: 2px 2px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000;
            z-index: 10;
        }
        #score { left: 20px; }
        #scoreboard { right: 150px; }

        #pause-button {
            position: absolute;
            top: 20px;
            right: 20px;
            font-family: 'Poppins', sans-serif;
            font-size: clamp(12px, 2.5vw, 16px);
            color: white;
            background: linear-gradient(45deg, #ff6b6b, #f0935d);
            border: none;
            border-radius: 8px;
            padding: 8px 18px;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s ease, background 0.2s ease;
        }
        #pause-button:hover {
            transform: scale(1.05);
            background: linear-gradient(45deg, #ff8787, #f7a87a);
        }
        #pause-button:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        /* Screens */
        #start-screen, #game-over-screen, #pause-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            padding: 20px;
            text-align: center;
        }
        #pause-screen, #game-over-screen { display: none; }

        #notification {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 215, 0, 0.95);
            color: #333;
            padding: 10px 20px;
            border-radius: 15px;
            font-size: clamp(14px, 2.8vw, 18px);
            z-index: 50;
            display: none;
        }

        #leaderboard, #achievements, #tips, #final-score, #pause-score {
            color: white;
            font-size: clamp(14px, 2.8vw, 18px);
            margin: 15px 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
        }
        #leaderboard h3, #achievements h3 {
            font-family: 'Press Start 2P', cursive;
            margin-bottom: 10px;
        }

        .button {
            padding: 12px 28px;
            margin: 10px;
            font-size: clamp(14px, 3vw, 18px);
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(45deg, #ff6b6b, #f0935d);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s ease, background 0.2s ease;
        }
        .button:hover {
            transform: scale(1.03);
            background: linear-gradient(45deg, #ff8787, #f7a87a);
        }
        .button:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        #start-screen h2, #game-over-screen h2, #pause-screen h2 {
            font-family: 'Press Start 2P', cursive;
            color: white;
            font-size: clamp(32px, 6vw, 48px);
            margin: 0 0 20px;
            text-shadow: 3px 3px 0 #000, -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000;
            animation: color-cycle 10s infinite linear;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            #game-container {
                width: 100vw;
                height: 75vw;
                border-width: 5px;
                border-radius: 10px;
            }
            #bird {
                width: 30px;
                height: 30px;
            }
            .pipe {
                border-width: 1px;
            }
            #score, #scoreboard, #pause-button {
                font-size: clamp(12px, 2.5vw, 16px);
            }
            .button {
                padding: 10px 20px;
                font-size: clamp(12px, 2.5vw, 16px);
            }
            #scoreboard { right: 100px; }
        }

        @media (min-width: 601px) and (max-width: 1024px) {
            #game-container {
                width: 90vw;
                height: 67.5vw;
            }
        }

        @media (min-width: 1025px) {
            #game-container {
                width: 800px;
                height: 600px;
            }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            #game-container {
                height: 90vh;
                width: 120vh;
                max-width: 800px;
            }
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.5); }
        }

        @keyframes color-cycle {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="bird"></div>
        <div id="score">Score: 0</div>
        <div id="scoreboard">Pipes: 0</div>
        <button id="pause-button" onclick="togglePause()">Pause</button>
        <div id="notification"></div>
        <div id="start-screen">
            <h2>Fly Circle</h2>
            <div id="leaderboard">Loading High Scores...</div>
            <div id="achievements">Loading Achievements...</div>
            <div id="tips">Controls: Spacebar, Click, or Tap to jump. Ctrl + P to pause/resume.</div>
            <div>
                <button class="button" onclick="startGame('easy')">Easy</button>
                <button class="button" onclick="startGame('medium')">Medium</button>
                <button class="button" onclick="startGame('hard')">Hard</button>
                <button class="button" id="nightmare-btn" onclick="startGame('nightmare')" style="display: none;">Nightmare</button>
            </div>
            <button class="button" onclick="resetHighScores()" style="background: linear-gradient(45deg, #888, #666);">Reset Scores</button>
        </div>
        <div id="pause-screen">
            <h2>Paused</h2>
            <div id="pause-score">Score: 0</div>
            <button class="button" onclick="togglePause()">Resume</button>
            <button class="button" onclick="retryGame()">Restart</button>
            <button class="button" onclick="quitToMenu()">Menu</button>
        </div>
        <div id="game-over-screen">
            <h2>Game Over</h2>
            <div id="final-score">Final Score: 0</div>
            <button class="button" onclick="retryGame()">Retry</button>
            <button class="button" onclick="quitToMenu()" style="background: linear-gradient(45deg, #aaa, #888);">Menu</button>
        </div>
    </div>

    <audio id="jump-sound" src="jump.mp3" preload="auto"></audio>
    <audio id="pipe-sound" src="pipe.mp3" preload="auto"></audio>
    <audio id="game-over-sound" src="gameover.mp3" preload="auto"></audio>
    <audio id="power-up-sound" src="powerup.mp3" preload="auto"></audio>
    <audio id="bg-music" src="bgmusic.mp3" loop preload="auto"></audio>

    <script>
        // DOM Elements
        const gameContainer = document.getElementById('game-container');
        const bird = document.getElementById('bird');
        const scoreDisplay = document.getElementById('score');
        const scoreboard = document.getElementById('scoreboard');
        const pauseButton = document.getElementById('pause-button');
        const startScreen = document.getElementById('start-screen');
        const pauseScreen = document.getElementById('pause-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const finalScore = document.getElementById('final-score');
        const leaderboard = document.getElementById('leaderboard');
        const achievementsDisplay = document.getElementById('achievements');
        const notification = document.getElementById('notification');
        const nightmareBtn = document.getElementById('nightmare-btn');
        const pauseScore = document.getElementById('pause-score');
        const jumpSound = document.getElementById('jump-sound');
        const pipeSound = document.getElementById('pipe-sound');
        const gameOverSound = document.getElementById('game-over-sound');
        const powerUpSound = document.getElementById('power-up-sound');
        const bgMusic = document.getElementById('bg-music');

        // Game State
        let birdY = 280, velocity = 0, score = 0, pipeCount = 0;
        let pipes = [], clouds = [], powerUps = [], trails = [];
        let gameOver = false, gameStarted = false, isPaused = false;
        let levelConfig = {}, pipeSpawnInterval, cloudSpawnInterval, powerUpSpawnInterval;
        let gameLoopId, multiplier = 1;

        // Constants
        const BIRD_SIZE = 40;
        const POWERUP_SIZE = 30;
        const VERTICAL_GAP = 152;
        const PIPE_WIDTH = 50;

        // Game Settings
        const levels = {
            easy: { gravity: 0.6, jump: -10, baseSpeed: 3.0, pipeFreq: 2000, powerUpChance: 0.15 },
            medium: { gravity: 0.7, jump: -11, baseSpeed: 4.0, pipeFreq: 1500, powerUpChance: 0.20 },
            hard: { gravity: 0.8, jump: -12, baseSpeed: 5.0, pipeFreq: 1000, powerUpChance: 0.25 },
            nightmare: { gravity: 0.9, jump: -13, baseSpeed: 6.0, pipeFreq: 800, powerUpChance: 0.30 }
        };

        // Local Storage
        let highScores = JSON.parse(localStorage.getItem('flappyHighScores')) || { easy: 0, medium: 0, hard: 0, nightmare: 0 };
        let achievements = JSON.parse(localStorage.getItem('achievements')) || [];

        function updateLeaderboard() {
            leaderboard.innerHTML = `<h3>High Scores:</h3>Easy: ${highScores.easy}<br>Medium: ${highScores.medium}<br>Hard: ${highScores.hard}<br>Nightmare: ${highScores.nightmare}`;
            nightmareBtn.style.display = highScores.hard >= 40 ? 'inline-block' : 'none';
            achievementsDisplay.innerHTML = `<h3>Achievements:</h3>${achievements.length > 0 ? achievements.join(', ') : 'None yet!'}`;
        }

        function resetHighScores() {
            highScores = { easy: 0, medium: 0, hard: 0, nightmare: 0 };
            achievements = [];
            localStorage.setItem('flappyHighScores', JSON.stringify(highScores));
            localStorage.setItem('achievements', JSON.stringify(achievements));
            updateLeaderboard();
            showNotification("Scores and Achievements Reset!");
        }

        function showNotification(message) {
            notification.textContent = message;
            notification.style.display = 'block';
            clearTimeout(notification.timeoutId);
            notification.timeoutId = setTimeout(() => notification.style.display = 'none', 4000);
        }

        // Game Logic
        function startGame(level) {
            if (!levels[level]) return;
            levelConfig = { ...levels[level], name: level };
            birdY = gameContainer.clientHeight / 2;
            velocity = 0;
            score = 0;
            pipeCount = 0;
            multiplier = 1;
            gameOver = false;
            gameStarted = true;
            isPaused = false;

            clearGameElements();
            scoreDisplay.textContent = `Score: ${score}`;
            scoreboard.textContent = `Pipes: ${pipeCount}`;
            bird.style.top = birdY + 'px';
            bird.style.display = 'block';
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            pauseScreen.style.display = 'none';
            pauseButton.textContent = 'Pause';

            clearInterval(pipeSpawnInterval);
            clearInterval(cloudSpawnInterval);
            clearInterval(powerUpSpawnInterval);
            pipeSpawnInterval = setInterval(createPipePair, levelConfig.pipeFreq);
            cloudSpawnInterval = setInterval(createCloud, 5000);
            powerUpSpawnInterval = setInterval(spawnPowerUp, 2500);

            bgMusic.currentTime = 0;
            bgMusic.play().catch(() => {});
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        function clearGameElements() {
            pipes.forEach(p => p.element.remove());
            clouds.forEach(c => c.element.remove());
            powerUps.forEach(p => p.element.remove());
            trails.forEach(t => t.remove());
            pipes = [];
            clouds = [];
            powerUps = [];
            trails = [];
        }

        function updateBird() {
            if (!gameStarted || gameOver || isPaused) return;
            velocity += levelConfig.gravity;
            birdY += velocity;
            birdY = Math.max(0, Math.min(birdY, gameContainer.clientHeight - BIRD_SIZE));
            bird.style.top = birdY + 'px';
            const rotation = Math.max(-30, Math.min(velocity * 4, 90));
            bird.style.transform = `rotate(${rotation}deg)`;
            if (birdY <= 0 || birdY >= gameContainer.clientHeight - BIRD_SIZE) endGame();
            if (Math.random() < 0.15) createTrail();
        }

        function createTrail() {
            if (trails.length > 10) return;
            const trail = document.createElement('div');
            trail.className = 'trail';
            trail.style.left = (bird.offsetLeft + BIRD_SIZE / 2 - 4) + 'px';
            trail.style.top = (bird.offsetTop + BIRD_SIZE / 2 - 4) + 'px';
            gameContainer.appendChild(trail);
            trails.push(trail);
            setTimeout(() => {
                trail.remove();
                trails = trails.filter(t => t !== trail);
            }, 500);
        }

        function createPipePair() {
            if (!gameStarted || gameOver || isPaused) return;
            const gameHeight = gameContainer.clientHeight;
            const minTopHeight = 50;
            const maxTopHeight = gameHeight - VERTICAL_GAP - minTopHeight;
            const topHeight = Math.random() * (maxTopHeight - minTopHeight) + minTopHeight;
            const bottomHeight = gameHeight - topHeight - VERTICAL_GAP;

            const topPipe = document.createElement('div');
            topPipe.className = 'pipe pipe-top';
            topPipe.style.height = topHeight + 'px';
            topPipe.style.width = PIPE_WIDTH + 'px';
            topPipe.style.left = gameContainer.clientWidth + 'px';
            topPipe.style.top = '0';
            gameContainer.appendChild(topPipe);

            const bottomPipe = document.createElement('div');
            bottomPipe.className = 'pipe pipe-bottom';
            bottomPipe.style.height = bottomHeight + 'px';
            bottomPipe.style.width = PIPE_WIDTH + 'px';
            bottomPipe.style.left = gameContainer.clientWidth + 'px';
            bottomPipe.style.bottom = '0';
            gameContainer.appendChild(bottomPipe); // Fixed typo: 'customPipe' to 'bottomPipe'

            pipes.push({ element: topPipe, x: gameContainer.clientWidth, width: PIPE_WIDTH, height: topHeight, isTop: true, passed: false });
            pipes.push({ element: bottomPipe, x: gameContainer.clientWidth, width: PIPE_WIDTH, height: bottomHeight, isTop: false, passed: false });
        }

        function createCloud() {
            if (clouds.length > 5 || Math.random() > 0.4) return;
            const cloud = document.createElement('div');
            cloud.className = 'cloud';
            cloud.style.left = gameContainer.clientWidth + 'px';
            cloud.style.top = (Math.random() * (gameContainer.clientHeight * 0.8)) + 'px';
            gameContainer.appendChild(cloud);
            clouds.push({ element: cloud, x: gameContainer.clientWidth, speedFactor: 0.3 + Math.random() * 0.4 });
        }

        function spawnPowerUp() {
            if (!gameStarted || gameOver || isPaused || Math.random() > levelConfig.powerUpChance) return;
            const powerUp = document.createElement('div');
            powerUp.className = 'power-up';
            powerUp.style.left = gameContainer.clientWidth + 'px';
            powerUp.style.top = (Math.random() * (gameContainer.clientHeight - POWERUP_SIZE * 2)) + POWERUP_SIZE + 'px';
            gameContainer.appendChild(powerUp);
            powerUps.push({ element: powerUp, x: gameContainer.clientWidth, type: 'slow' });
        }

        function updateObstacles() {
            if (isPaused || gameOver) return;
            const birdCenterX = bird.offsetLeft + BIRD_SIZE / 2;
            const birdCenterY = bird.offsetTop + BIRD_SIZE / 2;
            const birdRadius = BIRD_SIZE / 2;

            pipes.forEach((pipe, i) => {
                pipe.x -= levelConfig.baseSpeed;
                pipe.element.style.left = pipe.x + 'px';
                if (checkCollision(birdCenterX, birdCenterY, birdRadius, pipe)) endGame();
                if (!pipe.passed && pipe.isTop && birdCenterX > pipe.x + pipe.width) {
                    pipe.passed = true;
                    const bottomPipe = pipes.find(p => p.x === pipe.x && !p.isTop);
                    if (bottomPipe) bottomPipe.passed = true;
                    pipeCount++;
                    score += multiplier;
                    scoreDisplay.textContent = `Score: ${score}`;
                    scoreboard.textContent = `Pipes: ${pipeCount}`;
                    pipeSound.play().catch(() => {});
                    checkAchievements();
                }
                if (pipe.x + pipe.width < 0) {
                    pipe.element.remove();
                    pipes.splice(i, 1);
                }
            });

            clouds.forEach((cloud, i) => {
                cloud.x -= levelConfig.baseSpeed * cloud.speedFactor;
                cloud.element.style.left = cloud.x + 'px';
                if (cloud.x + cloud.element.offsetWidth < 0) {
                    cloud.element.remove();
                    clouds.splice(i, 1);
                }
            });

            powerUps.forEach((powerUp, i) => {
                powerUp.x -= levelConfig.baseSpeed;
                powerUp.element.style.left = powerUp.x + 'px';
                const dx = birdCenterX - (powerUp.x + POWERUP_SIZE / 2);
                const dy = birdCenterY - (powerUp.element.offsetTop + POWERUP_SIZE / 2);
                if (Math.sqrt(dx * dx + dy * dy) < birdRadius + POWERUP_SIZE / 2) {
                    powerUpSound.play().catch(() => {});
                    applyPowerUp(powerUp.type);
                    powerUp.element.remove();
                    powerUps.splice(i, 1);
                } else if (powerUp.x + POWERUP_SIZE < 0) {
                    powerUp.element.remove();
                    powerUps.splice(i, 1);
                }
            });
        }

        function checkCollision(birdX, birdY, birdR, pipe) {
            const closestX = Math.max(pipe.x, Math.min(birdX, pipe.x + pipe.width));
            const closestY = Math.max(pipe.y, Math.min(birdY, pipe.y + pipe.height));
            const distX = birdX - closestX;
            const distY = birdY - closestY;
            return (distX * distX + distY * distY) < (birdR * birdR);
        }

        function applyPowerUp(type) {
            if (type === 'slow' && !levelConfig.powerUpActive) {
                levelConfig.powerUpActive = true;
                const originalSpeed = levelConfig.baseSpeed;
                levelConfig.baseSpeed *= 0.5;
                showNotification("Pipes Slowed!");
                setTimeout(() => {
                    if (levelConfig.powerUpActive) {
                        levelConfig.baseSpeed = originalSpeed;
                        showNotification("Speed Restored!");
                        levelConfig.powerUpActive = false;
                    }
                }, 4000);
            }
        }

        function checkAchievements() {
            const achieve = (name) => {
                if (!achievements.includes(name)) {
                    achievements.push(name);
                    showNotification(`Achievement: ${name}!`);
                    localStorage.setItem('achievements', JSON.stringify(achievements));
                    updateLeaderboard();
                }
            };
            if (pipeCount >= 10) achieve('First 10 Pipes');
            if (score >= 50) achieve('Score 50+');
            if (levelConfig.name === 'nightmare' && score >= 20) achieve('Nightmare Conqueror');
        }

        function gameLoop() {
            if (gameOver) return;
            if (!isPaused) {
                updateBird();
                updateObstacles();
            }
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        function jump() {
            if (!gameStarted || gameOver || isPaused) return;
            velocity = levelConfig.jump;
            jumpSound.play().catch(() => {});
        }

        function togglePause() {
            if (!gameStarted || gameOver) return;
            isPaused = !isPaused;
            pauseButton.textContent = isPaused ? 'Resume' : 'Pause';
            pauseScreen.style.display = isPaused ? 'flex' : 'none';
            pauseScore.textContent = `Score: ${score}`;
            if (isPaused) {
                bgMusic.pause();
                clearInterval(pipeSpawnInterval);
                clearInterval(cloudSpawnInterval);
                clearInterval(powerUpSpawnInterval);
            } else {
                bgMusic.play().catch(() => {});
                pipeSpawnInterval = setInterval(createPipePair, levelConfig.pipeFreq);
                cloudSpawnInterval = setInterval(createCloud, 5000);
                powerUpSpawnInterval = setInterval(spawnPowerUp, 2500);
            }
        }

        function endGame() {
            if (gameOver) return;
            gameOver = true;
            gameStarted = false;
            clearInterval(pipeSpawnInterval);
            clearInterval(cloudSpawnInterval);
            clearInterval(powerUpSpawnInterval);
            cancelAnimationFrame(gameLoopId);
            gameOverSound.play().catch(() => {});
            bgMusic.pause();
            gameOverScreen.style.display = 'flex';
            finalScore.textContent = `Final Score: ${score}`;
            if (score > (highScores[levelConfig.name] || 0)) {
                highScores[levelConfig.name] = score;
                localStorage.setItem('flappyHighScores', JSON.stringify(highScores));
                updateLeaderboard();
                showNotification(`New High Score for ${levelConfig.name}!`);
            }
        }

        function retryGame() {
            gameOverScreen.style.display = 'none';
            pauseScreen.style.display = 'none';
            startGame(levelConfig.name || 'easy');
        }

        function quitToMenu() {
            gameOver = true;
            gameStarted = false;
            isPaused = false;
            cancelAnimationFrame(gameLoopId);
            clearInterval(pipeSpawnInterval);
            clearInterval(cloudSpawnInterval);
            clearInterval(powerUpSpawnInterval);
            bgMusic.pause();
            clearGameElements();
            bird.style.display = 'none';
            gameOverScreen.style.display = 'none';
            pauseScreen.style.display = 'none';
            startScreen.style.display = 'flex';
            updateLeaderboard();
        }

        // Input Handling
        function handleInput(e) {
            e.preventDefault();
            if (e.target.tagName === 'BUTTON') return;
            jump();
        }

        gameContainer.addEventListener('click', handleInput);
        gameContainer.addEventListener('touchstart', handleInput, { passive: false });
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                e.preventDefault();
                jump();
            } else if (e.ctrlKey && e.code === 'KeyP') {
                e.preventDefault();
                togglePause();
            }
        });

        // Resize Handling
        function resizeGame() {
            const width = Math.min(window.innerWidth * 0.9, 800);
            const height = Math.min(width * 0.75, window.innerHeight * 0.9);
            gameContainer.style.width = `${width}px`;
            gameContainer.style.height = `${height}px`;
            if (gameStarted && !gameOver) {
                birdY = gameContainer.clientHeight / 2;
                bird.style.top = birdY + 'px';
            }
        }
        window.addEventListener('resize', resizeGame);
        window.addEventListener('orientationchange', resizeGame);
        resizeGame();

        // Audio Unlock
        function unlockAudio() {
            [bgMusic, jumpSound, pipeSound, gameOverSound, powerUpSound].forEach(audio => {
                audio.play().then(() => audio.pause()).catch(() => {});
                audio.currentTime = 0;
            });
            document.removeEventListener('touchstart', unlockAudio);
            document.removeEventListener('click', unlockAudio);
        }
        document.addEventListener('touchstart', unlockAudio, { once: true });
        document.addEventListener('click', unlockAudio, { once: true });

        // Initialization
        window.addEventListener('load', () => {
            updateLeaderboard();
            bird.style.display = 'none';
        });
    </script>
</body>
    </html>
